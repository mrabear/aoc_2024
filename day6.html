<!DOCTYPE html>
<html>
	<!-- Brian's Advent of Code Solution Template -->

	<!-- stealing the advent of code style -->
	<head>
		<link href='http://fonts.googleapis.com/css?family=Source+Code+Pro:300&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
		<link rel="stylesheet" type="text/css" href="https://adventofcode.com/static/style.css?16"/>
		<link rel="stylesheet alternate" type="text/css" href="https://adventofcode.com/static/highcontrast.css?0" title="High Contrast"/>
	</head>

	<body style="font-family: 'Source Code Pro', monospace; font-size: 14pt; min-width: 0px;">

      	<script type="text/javascript">

		// Solve that shit

      	var grid = [[],[]];
		var gridWidth;
		var gridHeight; 

		var guard = { x: -1, y: -1, direction: "N", startX: -1, startY: -1 };

      	function solveThatShit(){
      		var startTime = new Date();
      		var input = new Array();
			var debug = document.getElementById("debug");
			input = document.getElementById("input").value.split("\n");

			debug.value = "Starting Run (" + input.length + " lines of input)\n==============================\n";
			
			// Build Grid
			for( var i = 0 ; i < input.length ; i++ ){
				if( guard.startX < 0 ){
					var startCheckX = input[i].indexOf( "^" );
					if( startCheckX >= 0 ){
						guard.startX = startCheckX;
						guard.startY = i;
					}
				}

				grid[i] = input[i].split("");
			}

			gridWidth = grid[0].length;
			gridHeight = grid.length; 

			// INSERT PART 1 SOLUTION HERE

			// Start guard patrol
			var part1Steps = 0;
			var part2Total = 0;
			var isInBounds = true;

			debug.value += "### starting patrol grid(" + gridWidth + "x" + gridHeight + ") start(" + guard.startX + "," + guard.startY + "," + guard.direction + ") ###\n"
			guard.x = guard.startX;
			guard.y = guard.startY;
			while( isInBounds ){
				part1Steps += markSpot( guard.x, guard.y );
				var nextStep = getNext( guard.x, guard.y );

				if( isBlocker( nextStep.x, nextStep.y ) ){
					turn();
					nextStep = getNext( guard.x, guard.y );
				}
				
				if( inBounds( nextStep.x, nextStep.y ) ){
					guard.x = nextStep.x;
					guard.y = nextStep.y;
				} else {
					isInBounds = false;
				}
			}

			debug.value += "### finished part 1 patrol in " + part1Steps + " steps ###\n";

			for( var testY = 0 ; testY < gridHeight ; testY++ ){
				for( var testX = 0 ; testX < gridWidth ; testX++ ){
					if( !isBlocker( testX, testY )){
						setGridValue( testX, testY, "#" );

						var stepsTaken = 0;
						var loopFound = false;
						var cornersTaken = [];

						isInBounds = true;
						guard.x = guard.startX;
						guard.y = guard.startY;
						guard.direction = "N";

						while( isInBounds && !loopFound ){
							var nextStep = getNext( guard.x, guard.y );
							var madeTurn = false;
							while( isBlocker( nextStep.x, nextStep.y ) ){
								turn();
								nextStep = getNext( guard.x, guard.y );
								madeTurn = true;
							}

							if( madeTurn ){
								var newCorner = guard.x + "," + guard.y;
								if( cornersTaken.includes( newCorner ) ){
									loopFound = true;
								} else {
									cornersTaken.push( newCorner );
								}
							}
							
							if( inBounds( nextStep.x, nextStep.y ) ){
								guard.x = nextStep.x;
								guard.y = nextStep.y;
								stepsTaken++;
							} else {
								isInBounds = false;
							}
						}

						setGridValue( testX, testY, "." );

						if( loopFound )
							part2Total++;
					}
				}
			}

			document.getElementById("part1").value = part1Steps;

			// INSERT PART 2 SOLUTION HERE

			document.getElementById("part2").value = part2Total;

			debug.value += "\n==============================\nRun Completed in " +  ((new Date() - startTime) / 1000 ).toFixed(2)  + " seconds\n";
		}

		function inBounds( x, y ){
			if( ( x < 0 || x >= gridWidth ) ||
				( y < 0 || y >= gridHeight ) )
				return false;
			else
				return true;
		}

		function turn(){
			if( guard.direction == "N" ){
				guard.direction = "E";

			} else if( guard.direction == "E" ){
				guard.direction = "S";
			} else if( guard.direction == "S" ){
				guard.direction = "W";
			} else if( guard.direction == "W" ){
				guard.direction = "N";
			}
		}

		function getNext() {
			var x = guard.x;
			var y = guard.y;

			if( guard.direction == "N" )
				y--;
			else if( guard.direction == "E" )
				x++;
			else if( guard.direction == "S" )
				y++;
			else if( guard.direction == "W" )
				x--;

			return{ x: x, y: y };
		}

		function isBlocker( x, y ){
			if( getGridValue(x,y) == "#" )
				return true;
			else
				return false;
		}

		function getGridValue( x, y ){
			if( inBounds( x, y ) )
				return( grid[y][x] );
			else
				return( "@" );
		}

		function setGridValue( x, y, value ){
				grid[y][x] = value;
		}

		function markSpot( x, y ){
			var newMark = 0;

			if( ( getGridValue( x, y ) == "." ) ||
				( getGridValue( x, y ) == "^" ) )
				newMark = 1;

			grid[y][x] = "X";

			return newMark;
		}

		</script>
		<div align="center">

			<!-- UPDATE SUBMISSION DAY HERE -->
			<!-- Page Title -->
			<h1 style="color: #00cc00;">Advent of Code 2024: Day 6 Submission ( <a href="https://adventofcode.com/2024/day/6" target="_blank">Overview</a> | <a href="https://github.com/mrabear/aoc_2024" target="_blank">Github</a> )</h1>

			<!-- COPY/PASTE SOURCE INPUT HERE -->
			<!-- Input Box -->
			<font style="color: #00cc00;">Input:</font><br>
			<textarea id="input" cols="80" rows="10" style="font-size: 16px; border:solid 1px #00cc00;">......................#...#..............#.....................................#...#..............##..............................
......#.....#................#....#...........#........#......................#...............................#.....#.#.###..#...#
...#.#.................#........#.................#.........................................................#.....................
.....................................................................................................#.........#..................
.............................#.................#...................................#.....#....#........................#....#.....
..........................#.....................................................................#..#.............#................
.................#...........................#..........................#..............................#.#..#...................#.
..#....#....#......................................................................#....#.........................................
..................................#............#...........#...........................................#.#....#.............#.#...
...#...##....................................................................................#..........#..................#......
..................#.....#......#.....#...#.........#..#.............................#....##.............#...............##.#..#...
......#...............................................................................................................#..........#
...........#................................#.......#.............#...............#...................................#...........
............##...........................#........................................................................#...............
...............................#........#...#.................................#..#.#.............#...........#....................
........#..........#.#....................................................#........#....#..#.................................#....
.........#..............#........................#................................................................................
..................#..........................#.............#..................#.#...........#.....#...............................
...#...........#.#..........#.....................................................................................................
..............#.................#.....................................................................#...#......#.....#..........
..#.....#................................................................................................#.#.....#..........#.....
#.#..........#...#.............................#...............#..................................................#.#.............
..........................#..#.............#................................................................................#.....
...#..............................................................................................#..............#..#.......#.....
........................................#......#........................................#...................##...........#........
.............#..............#...........................##...#............#.....#..#..............................................
..#....#..#...............#........#.................#............................................#........##...............#.....
................................................#.......#...........##.............................#.##...........................
............................#..............#..#...........#...#.....#.#...................#.....#.............................#...
....................#....................................................................................#........................
.......................................................................................#.......................##..#..............
#.............................#.............................................................#............................#........
..............................................................................#.............#...#.........##......................
...............#..........................#.............#............#...........................................#................
................#........................#................................#...#............#.............................#........
..............................................................#.....#..........#.......#........#....#..................#.........
........................................................#..............................................................#.......#..
..#........#............#........#...#.....#.......#..............................................................................
..#..............#.#.....................................#..................................................#....##...............
............#........................#..........##.................................................................#........#.....
............#............#.#...............................................#.......#..............................................
..................#.........................................#............................#......#..................#...........#..
........................................................#.............##................................#........................#
.....................#...#......#.......#............#........#..................#...#.#....................................#.....
...........................................................................................#..............................#....#..
....#...................#.............#..........#..................................#.............................................
......................................#...............................................#..#........................................
.................#..#............................................#.............................................................#.#
............##...................................................................................#.........................#......
.........#.................................................#..#........................................#.....#..........#.....#...
.........#........................................................................................#.#...............#............#
..........#..#...........#...................#.....#.......#......#....#..#.......................#..........#..........#.........
......#...................................................#....#..............#....#.........##...#...............................
.........#........#........................#...........................................................#.......#................#.
.....................#...............................................#.##.........................................................
................................................................................#.............#..............#............#.......
......#..........#............................................#...#....................#...............................#.........#
......................................#....#.........#..............................................................#...#.........
.......##...#.#..........................................................#............#...........#........#...................#..
.....#............................................................................#............................#..................
....#..................#....#......#......#......................#......................#.......................................#.
..#..............#..#............#.................................#............#..................#................#.............
........................................................#....#...................................##.......................#.......
..........#..................................#....#........#.......#..........................#................#...............#..
.....................................#.................#..................#...........#...........................................
.........#..............#...................................................................................#...................#.
.................##.................................#.......#.......................................................#.........#...
...........#.................#..........................#...............................#..#...........................#..........
.....................................#...........................#...................#..............................#..#..........
.............................#.....#.................................................#.................##...............#.......#.
............#.........................................................................................................#...........
..........##.............#...................#.#...........................................#....................................##
..........#..#...#...............#........#........................................................#.................#............
....................#......................#....................................................#.#.....................#.........
.......................................#............#........................##............#....#..#..............................
..........#..........#.....................................#.................................#.......#............................
....#.............#...............................................................................................................
..#..............................................#....#......#........................................#.................#.........
...#......#.....#..............................#....#....................#......#..................#...................#.......#..
...............#..#...........................##..................................................................................
........#..#.....#.........................#.......#.............#..........................................#................#....
...#......#.............#...............#.............................................................................##..........
#.................................#.......#.........#.#.#...................................#...#.#...........#..........#........
#.........#....#...#.........#.#.............................................................#....................................
........................#.#.......#.................................................#.............................................
...#...##...#..#...........................#.....#..........................#...............................#.......#.............
................#..............................#..........##...................................................................#..
.......................................................................#...#..#...#.....#....#..................##..........#.....
#.....................#.........#........#.....................................................................#.....#.......#....
...........#......................#.......#.................................................#........................#............
.......#.........................................#.....#...#...........#................#....#......#...........#......#..........
....#.............#...............................#...#....#..#..#...........................................#.............#......
...#.........#..........................................#.....#...........^.#...#....#...........................#................
.....#..#...............#...........................#.#..........#........................................................#.......
.............#.......#.............................................................................................#...#..........
..#...................#...............................#......#............#...........#.......#...................................
...........#.......................#..........#...#.......................#..............#.............##.............#..#........
..#............#.............#.......................................................#.....##....................................#
.#.........#.....................................................................#.........#......................................
.............#....................................................................#.....#.............#...#...........#..........#
..........................#.....#...#......................#.................................#.....#.................#.......#....
..........#.#.....................................................................................................................
............#.......#....................#.......#.............................................#..................................
.......................................#..#........#...................................................#..........................
...................#........#....#........#..................#..........................................................#.........
........#..............#....................#............#......#...........#.....#..............................#.........#......
.......#.....#.................#.#..#..............................................................#.......#..#...........#......#
.#....................##.....................................................#...#.....#..........................................
...........#..................#.....#....#............#...............#....#............#.......................#.................
........#.....................................#......##............#..........................#..........#....................#...
..........................#...............................................................#.......................................
......................#..................................#.....................#.............................................#...#
.........#..............................................................#........##.........#.......#.............................
....#...#........#...........#....#.............#............#.....#..............................................................
...........#...............................................................................................#.......#..#...........
........#..........................#............................#...........#............#.............................#..........
.......#...........................#...#...............#..#..#...................#.........#......................................
..#..............................#........#...........#.......................................#...#...............................
.............#...#.............#.........#...........#.....................................#................#.....................
.........................#..........................#.................................#...........................................
..................##.............#........#......#............#........................#.......#......................#....#......
.....#............................................................................................................................
.#..................................#.....#.............#...#.............................................#..............#..##..#.
...............#........................................................#.........#..#..........#.........................#.......
.............................................#...................#.................#..................#......................#....
............................#.......................................................................................#.............
............#...............#....................#....#..........#..#..............................#......#.......#.......##......
............#.................................................................................#...................................
........................#...............................................................#......#.......#.......#.......###......#.
......................................#.#.........................................#.....#.............................#.........#.</textarea><br><br>

			<!-- The 'run simulation' button and result fields -->
			<div style="display: inline-block;  border: 1px solid #00cc00; padding: 10px; margin-left: 10px;">
				<input type="button" onclick="solveThatShit();" value="[ Run Simulation ]"  style="background: transparent; border: 0; font-family: inherit; font-size: 26px; margin: 0; padding: 0; color: #009900; cursor: pointer;"><br>

				<p style="color: #00cc00;">
				    Part 1 Result: <input type = "text"  id = "part1" value = "" size=46/><input type="button" onclick="document.getElementById('part1').select();document.execCommand('copy');window.getSelection().removeAllRanges();" value="[ Copy ]"  style="background: transparent; border: 0; font-family: inherit; font-size: 16px; margin: 0; padding: 0; color: #009900; cursor: pointer;"><br>
				    Part 2 Result: <input type = "text"  id = "part2" value = "" size=46/><input type="button" onclick="document.getElementById('part2').select();document.execCommand('copy');window.getSelection().removeAllRanges();" value="[ Copy ]"  style="background: transparent; border: 0; font-family: inherit; font-size: 16px; margin: 0; padding: 0; color: #009900; cursor: pointer;"><br>
				</p>
			</div>

			<!-- Debug Output Box -->
			<br><br>

		    <font style="color: #00cc00;">Debug Output:</font><br>

		    <textarea id="debug" name="Text1" cols="80" rows="15" style="font-size: 16px; border:solid 1px #00cc00;"></textarea>
		</div>
	</body>
</html>